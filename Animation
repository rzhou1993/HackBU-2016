package com.jeffreychan.yutnori;

import android.app.Activity;
import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Point;
import android.graphics.Rect;
import android.os.Bundle;
import android.util.Log;
import android.view.SurfaceHolder;
import android.view.SurfaceView;
import android.view.View;


public class AnimationActivity extends Activity {
    Bitmap sealAnimBitmap;
    int numFrames = 7;
    AnimSurface animSurface;
    Rect rectToBeDrawn;
    Rect destRect;
    Paint paint;
    Canvas canvas;
    int frameNumber = 0;
    Point sealPosition = new Point(100,100);


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        sealAnimBitmap = BitmapFactory.decodeResource(getResources(),R.drawable.sealfilmstrip);
        animSurface = new AnimSurface(this);
        setContentView(animSurface);
    }

    public class AnimSurface extends SurfaceView implements Runnable {
        SurfaceHolder ourHolder;
        volatile boolean isAnimating;
        int frameWidth;
        int frameHeight;
        Thread ourThread = null;

        public AnimSurface(Context context) {
            super(context);
            ourHolder = getHolder();
            frameWidth = sealAnimBitmap.getWidth() / numFrames;
            frameHeight = sealAnimBitmap.getHeight();
            isAnimating = true;
            ourThread = new Thread(this);
            ourThread.start();
        }

        public void run() {
            while (isAnimating) {
                update();
                drawSeal();
            }
        }

        public void update() {
            rectToBeDrawn = new Rect((frameNumber * frameWidth)-1,0,
                    (frameNumber*frameWidth+frameWidth)-1,frameHeight);
            frameNumber++;
            if (frameNumber == numFrames ) {
                frameNumber = 0;
            }
            destRect = new Rect(sealPosition.x,sealPosition.y,
                    sealPosition.x+frameWidth,sealPosition.y+frameHeight );
            sealPosition.offset(10,10);
            if(sealPosition.x > 1000) {
                sealPosition.x = 100;
            }
            if(sealPosition.y > 1600) {
                sealPosition.x = 100;
            }
        }

        void drawSeal(){
            if(ourHolder.getSurface().isValid()) {
                canvas = ourHolder.lockCanvas();
                paint = new Paint();
                paint.setColor(Color.argb(255, 255, 255, 255));
                paint.setTextSize(60);
                canvas.drawText("testing", 500, 500, paint);
                canvas.drawRect(destRect,paint);
                //canvas.drawBitmap(sealAnimBitmap, rectToBeDrawn, destRect, null);
                ourHolder.unlockCanvasAndPost(canvas);
                Log.i("frameNumber","" + frameNumber);
            }
        }
    }
}
